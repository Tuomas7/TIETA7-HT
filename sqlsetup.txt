create schema keskus;
SET search_path to keskus;
SHOW SEARCH_PATH;

CREATE TABLE keskus.Divari (
	DivariID int NOT NULL,
	Nimi varchar(50) NOT NULL,
	Osoite varchar(80),
	Websivu varchar(50),
	Itsenainen boolean,
	PRIMARY KEY (DivariID)
);

CREATE TABLE keskus.Kayttaja (
	KayttajaID int NOT NULL,
	Nimi varchar(50) NOT NULL,
	Salasana varchar(50) NOT NULL,
	Rooli varchar(20) DEFAULT 'Asiakas',
	PRIMARY KEY (KayttajaID)
);

CREATE TABLE keskus.Yllapito (
	KayttajaID int NOT NULL,
	DivariID int NOT NULL,
	PRIMARY KEY (KayttajaID, DivariID),
	FOREIGN KEY (KayttajaID) REFERENCES keskus.Kayttaja(KayttajaID),
	FOREIGN KEY (DivariID) REFERENCES keskus.Divari(DivariID)
);

CREATE TABLE keskus.Asiakas (
	AsiakasID int NOT NULL,
	Etunimi varchar(50) NOT NULL,
	Sukunimi varchar(50) NOT NULL,
	Osoite varchar(80) NOT NULL,
	Sahkoposti varchar(50),
	Puhelin varchar(15),
	Saldo decimal(10,2) DEFAULT 0.00,
	PRIMARY KEY (AsiakasID),
	FOREIGN KEY (AsiakasID) REFERENCES keskus.Kayttaja(KayttajaID)
);

CREATE TABLE keskus.Teos (
	ISBN varchar(13) NOT NULL,
	Nimi varchar(50) NOT NULL,
	Tekija varchar(50),
	Vuosi int,
	Tyyppi varchar(30),
	Luokka varchar(30),
	Paino int NOT NULL,
	PRIMARY KEY (ISBN)
);

CREATE TABLE keskus.TeosKappale (
	KappaleID int NOT NULL,
	ISBN varchar(13) NOT NULL,
	Hinta decimal(10,2) NOT NULL,
	Ostohinta decimal(10,2) DEFAULT 0.00,
	MyyntiPvm date,
	Vapaus varchar(10) DEFAULT 'Vapaa',
	PRIMARY KEY (KappaleID),
	FOREIGN KEY (ISBN) REFERENCES keskus.Teos(ISBN)
);

CREATE TABLE keskus.Sijainti (
	DivariID int NOT NULL,
	KappaleID int NOT NULL,
	PRIMARY KEY (DivariID, KappaleID),
	FOREIGN KEY (DivariID) REFERENCES keskus.Divari(DivariID),
	FOREIGN KEY (KappaleID) REFERENCES keskus.TeosKappale(KappaleID)
);

CREATE TABLE keskus.Tilaus (
	TilausID int NOT NULL,
	DivariID int NOT NULL,
	AsiakasID int NOT NULL,
	KappaleID int NOT NULL,
	Tila varchar(10) DEFAULT 'Kaynnissa',
	PRIMARY KEY (TilausID),
	FOREIGN KEY (AsiakasID) REFERENCES keskus.Asiakas(AsiakasID),
	FOREIGN KEY (DivariID) REFERENCES keskus.Divari(DivariID),
	FOREIGN KEY (KappaleID) REFERENCES keskus.TeosKappale(KappaleID)
);

CREATE TABLE keskus.Postikulut (
	Paino int NOT NULL,
	Maksu decimal(10,2) NOT NULL,
	PRIMARY KEY (Paino)
);

CREATE TABLE keskus.Toimitus (
	TilausID int NOT NULL,
	Paino int NOT NULL,
	PRIMARY KEY (TilausID, Paino),
	FOREIGN KEY (TilausID) REFERENCES keskus.Tilaus(TilausID),
	FOREIGN KEY (Paino) REFERENCES keskus.Postikulut(Paino)
);

GRANT ALL PRIVILEGES ON table keskus.asiakas TO postgres;
GRANT ALL PRIVILEGES ON table keskus.kayttaja TO postgres;
GRANT ALL PRIVILEGES ON table keskus.teos TO postgres;
GRANT ALL PRIVILEGES ON table keskus.teoskappale TO postgres;
GRANT ALL PRIVILEGES ON table keskus.tilaus TO postgres;
GRANT ALL PRIVILEGES ON table keskus.sijainti TO postgres;

GRANT ALL PRIVILEGES ON SCHEMA keskus TO GROUP postgres;


create schema D1;

CREATE TABLE D1.Teos (
	ISBN varchar(13) NOT NULL,
	Nimi varchar(50) NOT NULL,
	Tekija varchar(50),
	Vuosi int,
	Tyyppi varchar(30),
	Luokka varchar(30),
	Paino int NOT NULL,
	PRIMARY KEY (ISBN)
);

CREATE TABLE D1.TeosKappale (
	KappaleID int NOT NULL,
	ISBN varchar(13) NOT NULL,
	Hinta decimal(10,2) NOT NULL,
	Ostohinta decimal(10,2) DEFAULT 0.00,
	MyyntiPvm date,
	Vapaus varchar(10) DEFAULT 'Vapaa',
	PRIMARY KEY (KappaleID),
	FOREIGN KEY (ISBN) REFERENCES D1.Teos(ISBN)
);

GRANT ALL PRIVILEGES ON table D1.teos TO postgres;
GRANT ALL PRIVILEGES ON table D1.teoskappale TO postgres;

GRANT ALL PRIVILEGES ON SCHEMA D1 TO GROUP postgres;


create schema D3;

CREATE TABLE D3.Teos (
	ISBN varchar(13) NOT NULL,
	Nimi varchar(50) NOT NULL,
	Tekija varchar(50),
	Vuosi int,
	Tyyppi varchar(30),
	Luokka varchar(30),
	Paino int NOT NULL,
	PRIMARY KEY (ISBN)
);

CREATE TABLE D3.TeosKappale (
	KappaleID int NOT NULL,
	ISBN varchar(13) NOT NULL,
	Hinta decimal(10,2) NOT NULL,
	Ostohinta decimal(10,2) DEFAULT 0.00,
	MyyntiPvm date,
	Vapaus varchar(10) DEFAULT 'Vapaa',
	PRIMARY KEY (KappaleID),
	FOREIGN KEY (ISBN) REFERENCES D3.Teos(ISBN)
);

GRANT ALL PRIVILEGES ON table D3.teos TO postgres;
GRANT ALL PRIVILEGES ON table D3.teoskappale TO postgres;

GRANT ALL PRIVILEGES ON SCHEMA D3 TO GROUP postgres;




INSERT INTO keskus.teos VALUES(12345,'sieppari','Arto',1984,'jannitys','romaani',40);
INSERT INTO keskus.teos VALUES(12325,'homeros','Esko',2000,'huumori','romaani',300);
INSERT INTO keskus.teos VALUES(13345,'l‰nsirintama','Simo',1800,'tietokirja','kaskut',400);
INSERT INTO keskus.teos VALUES(16345,'ajan lyhyt historia','Lauri',2010,'vitsit','romaani',80);
INSERT INTO keskus.teos VALUES(72345,'t‰‰ll‰ pohjant‰hden alla','Sepi',1987,'historia','romaani',40);
INSERT INTO keskus.teos VALUES(92345,'why','Kuka',1989,'jannitys','pokkari',100);

INSERT INTO keskus.teoskappale VALUES(1,12345,22,19,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(2,12345,22,10,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(3,13345,12,10,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(4,13345,22,17,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(5,12345,32,10,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(6,12345,22,10,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(7,16345,22,10,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(8,12345,22,10,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(9,16345,22,10,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(10,72345,22,10,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(11,92345,22,10,'10-10-1986');
INSERT INTO keskus.teoskappale VALUES(12,92345,22,10,'10-10-1986');

INSERT INTO keskus.sijainti VALUES(1,1);
INSERT INTO keskus.sijainti VALUES(1,2);
INSERT INTO keskus.sijainti VALUES(1,3);
INSERT INTO keskus.sijainti VALUES(1,4);
INSERT INTO keskus.sijainti VALUES(1,5);
INSERT INTO keskus.sijainti VALUES(1,6);
INSERT INTO keskus.sijainti VALUES(1,7);
INSERT INTO keskus.sijainti VALUES(1,8);
INSERT INTO keskus.sijainti VALUES(1,9);
INSERT INTO keskus.sijainti VALUES(1,10);
INSERT INTO keskus.sijainti VALUES(1,11);
INSERT INTO keskus.sijainti VALUES(1,12);

INSERT INTO keskus.teos VALUES('9155430674','Elektran tyt‰r','Madeleine Brent','1986','romaani','romantiikka','1467');
INSERT INTO keskus.teos VALUES('9156381451','Tuulentavoittelijan morsian','Madeleine Brent','1978','romaani','romantiikka','1356');
INSERT INTO keskus.teos VALUES('1230207500','Turms kuolematon','Mika Waltari','1995','romaani','historia','964');
INSERT INTO keskus.teos VALUES('9789510320990','Komisario Palmun erehdys','Mika Waltari','1940','romaani','dekkari','465');
INSERT INTO keskus.teos VALUES('9519201785','Friikkil‰n pojat Mexicossa','Shelton Gilbert','1989','sarjakuva','huumori','198');
INSERT INTO keskus.teos VALUES('9789510396230','Miten saan yst‰vi‰, menestyst‰, vaikutusvaltaa','Dale Carnegien','1939','tietokirja','opas','736');

INSERT INTO keskus.divari VALUES('1','Lassen Lehti','Lehtikatu 31, Tampere','www.lassenlehti.fi');
INSERT INTO keskus.divari VALUES('2','Galleinn Galle','Kallenkuja 4, Vaasa','www.galleinngalle.fi');
INSERT INTO keskus.divari VALUES('3','Antikvariaari Her‰tin','Triggerintie 58, Helsinki',null);
INSERT INTO keskus.divari VALUES('4','Puolirakenteinen Kirjakauppa','Entiteetinpolku 19, Oulu',null);




INSERT INTO D1.teos VALUES(12345,'sieppari','Arto',1984,'jannitys','romaani',40);
INSERT INTO D1.teos VALUES(13345,'l‰nsirintama','Simo',1800,'tietokirja','kaskut',400);

INSERT INTO D1.teoskappale VALUES(1,12345,22,19,'10-10-1986');
INSERT INTO D1.teoskappale VALUES(2,12345,22,10,'10-10-1986');
INSERT INTO D1.teoskappale VALUES(3,13345,12,10,'10-10-1986');
INSERT INTO D1.teoskappale VALUES(4,13345,22,17,'10-10-1986');
INSERT INTO D1.teoskappale VALUES(11,12345,22,17,'10-10-1986');
INSERT INTO D1.teoskappale VALUES(12,12345,22,17,'10-10-1986');